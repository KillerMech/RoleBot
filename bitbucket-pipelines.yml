#  Template python-build

#  This template allows you to validate your python code.
#  The workflow allows running tests and code linting on the default branch.

image: python:3.8

options:
  docker: true

pipelines:
  branches:
    production-main:
      - step:
          name: Docker Build
          deployment: production
          caches:
            - pip
          script:
            - export IMAGE_NAME=bascogroup/botty.py:$BITBUCKET_COMMIT
            - docker build -t $IMAGE_NAME .
            - docker login --username $DOCKER_USER --password $DOCKER_PASSS
            - docker push $IMAGE_NAME
    testing-main:
      - step:
          name: Docker Build
          deployment: test
          caches:
            - pip
          script:
            - export IMAGE_NAME=bascogroup/botty-test.py:$BITBUCKET_COMMIT
            - docker build -t $IMAGE_NAME .
            - docker login --username $DOCKER_USER --password $DOCKER_PASSS
            - docker push $IMAGE_NAME
